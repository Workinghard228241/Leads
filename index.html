<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Handsontable to Google Sheets</title>

    <!-- Handsontable CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/handsontable@10.1.0/dist/handsontable.full.min.css">

    <!-- jQuery (required for AJAX calls) -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- Handsontable JS -->
    <script src="https://cdn.jsdelivr.net/npm/handsontable@10.1.0/dist/handsontable.full.min.js"></script>
</head>
<body>
    <h1>Collaborative Data Entry</h1>
    <div id="table-container"></div>

    <script>
        // Ensure Handsontable is loaded before using it
        if (typeof Handsontable === "undefined") {
            console.error('Handsontable library is not loaded correctly!');
        } else {
            console.log('Handsontable is successfully loaded!');
        }

        const scriptUrl = 'https://script.google.com/macros/s/AKfycbwpYQEzXAM-Nb86GKxwzw3rExEWzbD9TWcm1rQSZezaN7WAG2FolUKULHN_doITSTsqhg/exec'; // Google Apps Script URL

        const container = document.querySelector('#table-container');

        // Initialize Handsontable
        const hot = new Handsontable(container, {
            data: [],
            colHeaders: ['ID', 'Name', 'Status'],
            rowHeaders: true,
            columnSorting: true,
            licenseKey: 'non-commercial-and-evaluation',
            afterChange: function (changes, source) {
                if (source === 'loadData') {
                    return;  // Prevent saving when loading data
                }
                saveDataToGoogleSheets(hot.getData());
            }
        });

        // Fetch data from Google Sheets when the page loads
        window.onload = function () {
            fetch(scriptUrl)
                .then(response => response.json())
                .then(result => {
                    const tableData = result.table || [];
                    hot.loadData(tableData);  // Load the data into Handsontable
                })
                .catch(error => {
                    console.error('Error fetching data from Google Sheets:', error);
                });
        };

        // Save data to Google Sheets
        function saveDataToGoogleSheets(data) {
            fetch(scriptUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ table: data })  // Send updated data
            })
                .then(response => response.json())
                .then(result => {
                    console.log('Data saved successfully:', result);
                })
                .catch(error => {
                    console.error('Error saving data:', error);
                });
        }
    </script>
</body>
</html>
