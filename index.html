<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Handsontable to Google Sheets</title>

    <!-- Handsontable CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/handsontable@10.1.0/dist/handsontable.full.min.css">

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- Handsontable JS -->
    <script src="https://cdn.jsdelivr.net/npm/handsontable@10.1.0/dist/handsontable.full.min.js"></script>
</head>
<body>
    <h1>Collaborative Data Entry</h1>
    <div id="table-container"></div>
    
    <script>
        // Google Apps Script URL (Ensure you deploy the script as a web app and copy the URL here)
        const scriptUrl = 'https://script.google.com/macros/s/AKfycbwpYQEzXAM-Nb86GKxwzw3rExEWzbD9TWcm1rQSZezaN7WAG2FolUKULHN_doITSTsqhg/exec';

        // Handsontable configuration
        const container = document.querySelector('#table-container');
        const hot = new Handsontable(container, {
            data: [],
            colHeaders: ['ID', 'Name', 'Status'],
            rowHeaders: true,
            columnSorting: true,
            licenseKey: 'non-commercial-and-evaluation', // For non-commercial use
            afterChange: function (changes, source) {
                if (source === 'loadData') {
                    return;
                }
                saveDataToGoogleSheets(hot.getData());
            }
        });

        // Fetch existing data from Google Sheets when the page loads
        window.onload = function() {
            fetch(scriptUrl)
                .then(response => response.json())
                .then(result => {
                    const tableData = result.table || [];
                    hot.loadData(tableData);
                })
                .catch(error => console.error('Error fetching data from Google Sheets:', error));
        };

        // Save updated data to Google Sheets
        function saveDataToGoogleSheets(data) {
            fetch(scriptUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ table: data })
            })
            .then(response => response.json())
            .then(result => {
                console.log("Data saved successfully:", result);
            })
            .catch(error => {
                console.error("Error saving data:", error);
            });
        }
    </script>
</body>
</html>
